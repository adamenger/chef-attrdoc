#!/usr/bin/env ruby

require 'optparse'

require 'chef_attrdoc'

options = {}

opt_parser = OptionParser.new do |opts|
  opts.banner = "Usage: chef_attrdoc.rb [options]"

  opts.on("-d", "--directory DIR", "Cookbook directory (defaults to current dir)") do |d|
    options[:dir] = d
  end

  options[:readme] = "README.md"
  opts.on("-r", "--readme README",
    "Readme file name, relative to DIR, defaults to README.md must be markdown") do |r|
    options[:readme] = readme
  end

  opts.on_tail("-h", "--help", "Show this message") do
    puts opts
    exit
  end
end.parse!

if options[:dir]
  file = File.read(File.join(options[:dir], "attributes", "default.rb"))
  readme = File.join(options[:dir], options[:readme])
else
  file = File.read(File.join("attributes", "default.rb"))
  readme = options[:readme]
end


attrs = ChefAttrdoc::AttributesFile.new file
attrs.to_readme readme
